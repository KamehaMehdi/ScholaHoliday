# Migration `20200702112124-20200702110402-add-fields-and-reservation-logement`

This migration has been generated by Michael Vieira at 7/2/2020, 11:21:24 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."Logement" (
"created_at" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"deleted_at" DATE   ,"description" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"in_maintenance" BOOLEAN NOT NULL DEFAULT false ,"name" TEXT NOT NULL  ,"number" INTEGER NOT NULL  ,"reservationId" TEXT   ,"type" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("type") REFERENCES "LogementType"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("reservationId") REFERENCES "Reservation"("id") ON DELETE SET NULL ON UPDATE CASCADE)

CREATE TABLE "quaint"."LogementType" (
"id" TEXT NOT NULL  ,"name" TEXT NOT NULL  ,"price" INTEGER NOT NULL  ,
    PRIMARY KEY ("id"))

CREATE TABLE "quaint"."Evenement" (
"created_at" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"employe" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"logement" TEXT NOT NULL  ,"tache" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("logement") REFERENCES "Logement"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("employe") REFERENCES "Employe"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."Employe" (
"contract_type" TEXT NOT NULL  ,"created_at" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"deleted_at" DATE   ,"disabled" BOOLEAN NOT NULL DEFAULT false ,"email" TEXT NOT NULL  ,"end_date" DATE NOT NULL  ,"firstname" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"lastname" TEXT NOT NULL  ,"password" TEXT NOT NULL  ,"role" TEXT NOT NULL  ,"start_date" DATE NOT NULL  ,"username" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("role") REFERENCES "Role"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."Role" (
"id" TEXT NOT NULL  ,"name" TEXT NOT NULL  ,"permission" TEXT NOT NULL  ,
    PRIMARY KEY ("id"))

CREATE TABLE "quaint"."Reservation" (
"check_in" DATE   ,"check_out" DATE   ,"client" TEXT NOT NULL  ,"created_at" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"deleted_at" DATE   ,"description" TEXT NOT NULL  ,"end_date" DATE NOT NULL  ,"id" TEXT NOT NULL  ,"price" INTEGER NOT NULL  ,"start_date" DATE NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("client") REFERENCES "Client"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."ReservationLogement" (
"id" TEXT NOT NULL  ,"logement" TEXT NOT NULL  ,"reservation" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("logement") REFERENCES "Logement"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("reservation") REFERENCES "Reservation"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."EtatLieu" (
"created_at" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"employe" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"logement" TEXT NOT NULL  ,"report" TEXT NOT NULL  ,"reservation" TEXT NOT NULL  ,
    PRIMARY KEY ("id"),FOREIGN KEY ("reservation") REFERENCES "Reservation"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("logement") REFERENCES "Logement"("id") ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY ("employe") REFERENCES "Employe"("id") ON DELETE CASCADE ON UPDATE CASCADE)

CREATE TABLE "quaint"."Client" (
"address" TEXT NOT NULL  ,"banned" BOOLEAN NOT NULL DEFAULT false ,"created_at" DATE NOT NULL DEFAULT CURRENT_TIMESTAMP ,"deleted_at" DATE   ,"email" TEXT NOT NULL  ,"id" TEXT NOT NULL  ,"name" TEXT NOT NULL  ,"phone_number" TEXT NOT NULL  ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "quaint"."LogementType.name" ON "LogementType"("name")

CREATE UNIQUE INDEX "quaint"."Employe.username" ON "Employe"("username")

CREATE UNIQUE INDEX "quaint"."Client.name" ON "Client"("name")

CREATE UNIQUE INDEX "quaint"."Client.email" ON "Client"("email")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200630120512-add-timestamp-to-tables..20200702112124-20200702110402-add-fields-and-reservation-logement
--- datamodel.dml
+++ datamodel.dml
@@ -2,30 +2,31 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model Logement {
   id String @id @default(cuid())
-  name String @unique
+  name String
+  description String
+  number Int
   type String
-  LogementType Logement @relation(fields: [type])
-  location String
-  default_price Int
+  LogementType LogementType @relation(fields: [type])
   in_maintenance Boolean @default(false)
   created_at DateTime @default(now())
   deleted_at DateTime?
 }
 model LogementType {
   id String @id @default(cuid())
   name String @unique
+  price Int
 }
 model Evenement {
   id String @id @default(cuid())
@@ -38,15 +39,19 @@
 }
 model Employe {
   id String @id @default(cuid())
-  name String
+  lastname String
+  firstname String
   role String
   Role Role @relation(fields: [role])
   username String @unique
   password String
   email String
   disabled Boolean @default(false)
+  start_date DateTime
+  end_date DateTime
+  contract_type String
   created_at DateTime @default(now())
   deleted_at DateTime?
 }
@@ -59,19 +64,27 @@
 model Reservation {
   id String @id @default(cuid())
   client String
   Client Client @relation(fields: [client])
-  logement String
-  Logement Logement @relation(fields: [logement])
+  logements Logement[]
   price Int
+  description String
   start_date DateTime
   end_date DateTime
   check_in DateTime?
   check_out DateTime?
   created_at DateTime @default(now())
   deleted_at DateTime?
 }
+model ReservationLogement {
+  id String @id @default(cuid())
+  logement String
+  Logement Logement @relation(fields: [logement])
+  reservation String
+  Reservation Reservation @relation(fields: [reservation])
+}
+
 model EtatLieu {
   id String @id @default(cuid())
   reservation String
   logement String
```


